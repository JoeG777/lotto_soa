FROM python:3.9-alpine

ENV RABBIT_INIT_ROOT_USERNAME=${RABBIT_INIT_ROOT_USERNAME}
ENV RABBIT_INIT_ROOT_PASSWORD=${RABBIT_INIT_ROOT_PASSWORD}
ENV RABBIT_PORT=${RABBIT_PORT}
ENV RABBIT_HOST=${RABBIT_HOST}

ENV MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
ENV MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
ENV MONGO_PORT=${MONGO_PORT}
ENV MONGO_HOST=${MONGO_HOST}

ENV QUEUE_DRAWING_EVENT=${QUEUE_DRAWING_EVENT}
ENV CUSTOMER_DATABASE_NAME=${CUSTOMER_DATABASE_NAME}
ENV CUSTOMER_COLLECTION_NAME=${CUSTOMER_COLLECTION_NAME}

ENV DEFAULT_INTERNAL_SERVICE_PORT=${DEFAULT_INTERNAL_SERVICE_PORT}


COPY src/requirements.txt /usr/src/requirements.txt
RUN pip install -r /usr/src/requirements.txt
RUN apk --no-cache add curl

COPY src /usr/src
COPY start_script/run.sh /usr/run.sh
RUN chmod +x /usr/run.sh

WORKDIR /usr
EXPOSE $DEFAULT_INTERNAL_SERVICE_PORT

CMD ./run.sh $DEFAULT_INTERNAL_SERVICE_PORT