FROM python:3.9-alpine

ENV RABBIT_INIT_ROOT_USERNAME=${RABBIT_INIT_ROOT_USERNAME}
ENV RABBIT_INIT_ROOT_PASSWORD=${RABBIT_INIT_ROOT_PASSWORD}
ENV RABBIT_PORT=${RABBIT_PORT}
ENV RABBIT_HOST=${RABBIT_HOST}

ENV MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}
ENV MONGO_INITDB_ROOT_PASSWORD=${MONGO_INITDB_ROOT_PASSWORD}
ENV MONGO_PORT=${MONGO_PORT}
ENV MONGO_HOST=${MONGO_HOST}

ENV QUEUE_DRAWING_EVENT=${QUEUE_DRAWING_EVENT}
ENV CUSTOMER_COLLECTION_NAME=${CUSTOMER_COLLECTION_NAME}


COPY src/requirements.txt /usr/src/requirements.txt
RUN pip install -r /usr/src/requirements.txt

COPY src /usr/src
COPY .env /usr/.env
COPY start_script/run_parallel.sh /usr/run_parallel.sh
COPY start_script/run_specific.sh /usr/run_specific.sh

WORKDIR /usr
EXPOSE 8080
CMD ./run_specific.sh